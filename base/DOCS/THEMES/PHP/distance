The section on the internal structure explains the relationship between listings, children and parents which is exposed in the xml format.

 

When using proximity search, and the loadnear search attribute is set to 1, each match will contain a near element which contains the listing which matched the right-hand side of the search. To calculate the (approximate) distance and bearing between the two matches, the following PHP code can be used:

 

function distancebearing($lat1,$lon1,$lat2,$lon2) {

  $Rearth=6371000;

 

  $dlat=($lat1-$lat2)*M_PI/180*$Rearth;

  $dlon=($lon1-$lon2)*cos($lat1*M_PI/180)*M_PI/180*$Rearth;

 

  $dist=sqrt($dlat*$dlat+$dlon*$dlon);

  $dir=180/M_PI*atan2(-$dlon,$dlat);

  if ($dir<0) $dir+=360;

 

  return array($dist,$dir);

}
